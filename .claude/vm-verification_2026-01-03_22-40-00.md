# VM Verification Report - Commit d4eb0a7

**Date**: 2026-01-03 22:40:00
**Commit**: d4eb0a7b414d89f75cf74a9f9035d52854037567
**Title**: refactor: consolidate vendor merge logic and add shell safety

## Verification Summary

| VM Type | Build Status | Boot Status | Shell Working |
|---------|--------------|-------------|---------------|
| QEMU | PASS | PASS | PASS |
| Cloud Hypervisor | PASS | PASS | PASS |

## QEMU Verification

### Boot Sequence
- UEFI bootloader: OK
- RedoxFS detection: OK (310 MiB filesystem found)
- Kernel loading: OK (1 MiB)
- InitFS loading: OK (32 MiB)
- Framebuffer: OK (1280x800)
- Memory: 1977 MB detected
- Driver loading: OK
- RedoxFS mount: OK
- Ion shell: OK (all builtins available)

### Network (QEMU User-mode NAT)
- DHCP discovery: OK
- IP obtained: 10.0.2.15/24
- Gateway: 10.0.2.2
- DNS: 10.0.2.3
- Static fallback also applied (172.16.0.2/24)

### Expected Errors (Headless Mode)
- ps2d panic: "No such device" - Expected, no PS/2 keyboard in headless QEMU
- PCIe fallback to PCI 3.0 - Expected, no MCFG table in QEMU

## Cloud Hypervisor Verification

### Boot Sequence
- UEFI firmware (CLOUDHV.fd): OK
- Boot0002 "UEFI Misc Device": OK
- RedoxFS detection: OK (310 MiB filesystem found)
- Kernel loading: OK (1 MiB)
- InitFS loading: OK (32 MiB)
- Memory: 1978 MB detected
- Driver loading: OK
- RedoxFS mount: OK
- Ion shell: OK (all builtins available)

### Expected Differences from QEMU
- Framebuffer: Not found (no virtio-gpu in headless mode)
- HPET: Unable to find (expected for Cloud Hypervisor)
- Network: No adapter (this run used the no-network variant)
- ps2d panic: Expected in headless mode

## Files Changed in Commit

The refactoring affected 8 core packages:
1. `bootloader` - Vendor merge consolidated
2. `kernel` - Vendor merge consolidated
3. `relibc` - Vendor merge consolidated
4. `base` - Vendor merge consolidated
5. `bootstrap` - Vendor merge consolidated
6. `mk-userspace` - Vendor merge consolidated
7. `sodium` - Vendor merge consolidated
8. `extrautils` - Vendor merge consolidated

All packages built successfully with the new centralized `vendor.mkMergedVendor` function.

## Shell Safety Improvements Verified

The following scripts now have `set -euo pipefail`:
- comprehensive-qemu-test.sh
- run-auto-enter.sh
- run-interactive.sh
- run-redox-auto.sh
- test-qemu-configs.sh
- test-redox.sh
- test-working-configs.sh

## Conclusion

**VERIFICATION PASSED**

The vendor merge consolidation and shell safety improvements are working correctly. Both QEMU and Cloud Hypervisor successfully:
1. Built the disk image with the refactored vendor logic
2. Booted through UEFI to the bootloader
3. Loaded the kernel and initfs
4. Mounted RedoxFS
5. Started the Ion shell with all builtins functional

The ~265 lines of duplicated code removed have been successfully replaced by the centralized `vendor.mkMergedVendor` function without breaking any functionality.
